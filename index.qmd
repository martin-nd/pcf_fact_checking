---
title: Fact Checking PCF
author: Martin Sloley
date: today
execute:
  warning: false
  message: false
  echo: false
format:
  html:
    theme: darkly
    self-contained: true
    toc: true
---

```{r}
#libraries
library(tidyverse)
library(ggiraph)
library(gtable)
library(readxl)
library(geomtextpath)
library(reshape2)
library(htmltools)
library(stringr)
library(gt)
library(ggrepel)

reliability = read_xlsx('data/all_reliability.xlsx')
sales = read_xlsx('data/all_sales.xlsx')
```

# Introduction

## Overview

Recently, an organization called the [Protect our Communities Foundation](https://www.protectourcommunities.org) (PCF) went before the California Public Utilities Commission as an intervener to criticize some of the work done by local utility [San Diego Gas & Electric](https://www.sdge.com) (SDGE). In order to better understand PCF's grievances with SDGE, I visited their website and found a page called [Facts on SDG&E](https://www.protectourcommunities.org/facts-on-sdge) with facts & figures complete with linked data sources. To me, this is a perfect opportunity to see whether PCF has their facts straight and whether they are appropriately upset with the utility giant.

## Methodology

In this investigation I will use the data sources provided by PCF to fact-check the claims they make about SDGE. The data I will mostly be using is historical data provided by the [US Energy Information Administration](https://www.eia.gov), specifically the [annual electric power industry report](https://www.eia.gov/electricity/data/eia861/). I have taken data from 2010 to 2024 and collated sales / rate data and grid reliability data into larger datasets that I will use to go beyond the initial claims of PCF to observe any nuance to the situation through time. Data engineering and raw data, as well as the code used to generate the findings in this document can be found in the [github repository](https://github.com/martin-nd/pcf_fact_checking).

I come to these claims with preconcieved political and social opinions, but I am dedicated to desribing and displaying the data accurately and truthfully, and we will judge PCF and SDGE based only on what is factually true based on the available data.

Until the conclusion where I will offer some editorialization.

Let's check some facts.

# Fact Checking

## Reliability

::: {.callout-note}
## From PCF's 'Facts on SDG&E'
SDG&E provides below-average reliability compared to other California utilities. [Source Data](https://www.eia.gov/electricity/data/eia861/): U.S. Energy Information Administration, 2020 Data, EIA-861S
:::

Before we check this claim, let's define some metrics that power utilities use to track their reliability.

1. **CMI**: This stands for *Customer Minutes Interrupted* and is calculated by taking the length of an outage in minutes and multiplying it by the number of customers affected by the outage. This can also be communicated in hours occasionally, but is usually kept in minutes.

2. **SAIDI** (pronounced like the name 'Sadie'): This stands for *System Average Interruption Duration Index*. It is calculated by taking total CMI and dividing by the total number of customers served. For example, if you run a power company that serves 5 customers, and you have one outage that lasts 2 hours that affects 2 customers for a total of $\text{2 customers} \times \text{120 minutes} = 240$ CMI, your SAIDI for the year is: $\frac{\text{240 CMI}}{\text{5 customers}} = 48$. As such, a *lower* SAIDI indicates *better* system reliability.

3. **SAIFI** (pronounced like 'safety' without the 't'): This stands for *System Average Interruption Frequency Index*. It is calculated by taking the number of customer interruptions (outages) and then dividing by the total number of customers. Taking the previous example, you would have a total of $\text{2 customers} \times \text{1 interruption} = 2$ customer interruptions, your SAIFI for the year is $\frac{\text{2 customer interruptions}}{\text{5 customers}} = 0.4$. As such, a *lower* SAIFI indicates *better* system reliability.

4. **CAIDI** (pronounced like the acronym 'K/D'): This stands for *Customer Average Interruption Duration Index*. It is calculated by taking the total CMI and dividing by the total number of customer interruptions. Taking our previous examples with 240 CMI and 2 customer interruptions your CAIDI for the year is: $\frac{\text{240 CMI}}{\text{2 customer interruptions}} = 120$. The algebraically-minded among you may have noticed that CAIDI can also be calculated as $\frac{\text{SAIDI}}{\text{SAIFI}}$. A *lower* CAIDI indicates *better* system reliability.

To check this claim, we can observe the distribution of reliability metrics for CA power utilities in 2020 below.

```{r}
rel_ca_2020 = reliability %>%
  filter(
    state == 'CA',
    data_year == 2020
  )

rel_ca_2020_melted = melt(
  rel_ca_2020,
    id.vars = c('utility_name'),
    measure.vars = c('saidi', 'saifi', 'caidi'),
    variable.name = 'metric'
  ) %>%
  mutate(
    metric = str_to_upper(metric)
  )

sdge = rel_ca_2020_melted %>%
  filter(
    utility_name == 'San Diego Gas & Electric Co'
  )

ggplot(rel_ca_2020_melted, aes(x = '', y = value)) +
  geom_boxplot() +
  facet_wrap(~metric, scales = 'free') +
  geom_hline(data = sdge, aes(yintercept = value), color = '#00197C') +
  geom_text(data = sdge, aes(y = value, label = 'SDGE'), vjust = -6, hjust = 1.4, angle = 45) +
  theme_minimal() +
  labs(
    title = 'Reliability Metric Distributions',
    subtitle = 'USEIA 2020 Data',
    x = '',
    y = ''
  )
```

We can clearly see that in 2020 SDGE had higher than average SAIDI, SAIFI, and CAIDI indicating below average grid reliability.

Let's also observe the most current data at time of writing, 2024.

```{r}
rel_ca_2024 = reliability %>%
  filter(
    state == 'CA',
    data_year == 2024
  )

rel_ca_2024_melted = melt(
  rel_ca_2024,
    id.vars = c('utility_name'),
    measure.vars = c('saidi', 'saifi', 'caidi'),
    variable.name = 'metric'
  ) %>%
  mutate(
    metric = str_to_upper(metric)
  )

sdge = rel_ca_2024_melted %>%
  filter(
    utility_name == 'San Diego Gas & Electric Co'
  )

ggplot(rel_ca_2024_melted, aes(x = '', y = value)) +
  geom_boxplot() +
  facet_wrap(~metric, scales = 'free') +
  geom_hline(data = sdge, aes(yintercept = value), color = '#001980') +
  geom_text(data = sdge, aes(y = value, label = 'SDGE'), vjust = -6.2, hjust = 1.4, angle = 45) +
  theme_minimal() +
  labs(
    title = 'Reliability Metric Distributions',
    subtitle = 'USEIA 2024 Data',
    x = '',
    y = ''
  )
```

It would seem that SDGE has successfully managed to reduce the average number of outages per customer, but unfortunately those outages are still longer and larger than average for CA.

Let's now observe how SDGE compares to the CA median through the years.

```{r}
mycolors = c('#a1a1a0', '#001980')

rel_ca_averages = reliability %>%
  filter(state == 'CA') %>%
  melt(
    id.vars = c('data_year', 'utility_name'), 
    measure.vars = c('saifi', 'saidi', 'caidi'),
    variable.name = 'metric'
  ) %>%
  group_by(data_year, metric) %>%
  summarize(
    value = median(value, na.rm = TRUE)
  )

rel_ca_averages$utility_name = 'CA Median'
rel_ca_averages = rel_ca_averages %>%
  select(
    data_year,
    utility_name,
    metric,
    value
  )

sdge = reliability %>%
  filter(
    state == 'CA',
    str_count(utility_name, 'San Diego') > 0
  ) %>%
  melt(
    id.vars = c('data_year', 'utility_name'),
    measure.vars = c('saifi', 'saidi', 'caidi'),
    variable.name = 'metric'
  )

sdge$utility_name = 'SDGE'

ts_df = rbind(
    rel_ca_averages,
    sdge
  ) %>%
  mutate(
    metric = str_to_upper(metric)
  )

ggplot(
    ts_df, 
    aes(
      x = data_year, y = value, 
      color = utility_name, group = utility_name
    )
  ) +
  geom_textline(aes(label = utility_name), hjust = 0.3) +
  facet_grid(metric ~ ., scales = 'free_y') +
  theme_minimal() +
  labs(
    title = 'SDGE vs CA Median',
    subtitle = 'USEIA 2013-2024 Data',
    x = '',
    y = ''
  ) +
  theme(
    legend.position = 'none'
  ) +
  scale_color_manual(values = mycolors)
```

Interesting, this tells us a very different story. I know now why PCF picked 2020 as their data year and has not updated it. We can see clearly that SDGE usually performs better than average on SAIFI, is about average on SAIDI, and performs a bit worse than average on CAIDI. In other words, SDGE usually has fewer outages per customer than median, about average outage duration per customer, and slightly worse than average outage duration per outage. If one were to be an SDGE customer, one could expect fewer outages than normal, but those outages may last longer than usual.

Before we move on to the next claim, let's do a statistical test to check for a meaningful difference in year-over-year reliability metrics between SDGE & the CA median.

```{r}
sdge_saidi = sdge %>% filter(metric == 'saidi')
sdge_saifi = sdge %>% filter(metric == 'saifi')
sdge_caidi = sdge %>% filter(metric == 'caidi')

median_saidi = rel_ca_averages %>% filter(metric == 'saidi')
median_saifi = rel_ca_averages %>% filter(metric == 'saifi')
median_caidi = rel_ca_averages %>% filter(metric == 'caidi')

saidi_test = t.test(sdge_saidi$value, median_saidi$value)
saifi_test = t.test(sdge_saifi$value, median_saifi$value)
caidi_test = t.test(sdge_caidi$value, median_caidi$value)

metric_df = data.frame(
  `Metric Tested` = c('SAIDI', 'SAIFI', 'CAIDI'),
  `SDGE Mean` = c(mean(sdge_saidi$value), mean(sdge_saifi$value), mean(sdge_caidi$value)),
  `CA Median Mean` = c(mean(median_saidi$value), mean(median_saifi$value), mean(median_caidi$value)),
  `P Value` = c(saidi_test$p.value, saifi_test$p.value, caidi_test$p.value)
)

gt(metric_df)
```

These statistical tests reinforce the conclusions drawn from the above visual.

### Final Fact-Check Status

*Technically True*

{{< video https://www.youtube.com/watch?v=aIzMuPMicGc >}}

Although the generalized claim is somewhat intellectually dishonest, for the year they cite as their data source, the claim is unequivocally true. However, that single year does not tell the whole story, and the real situation is more complex. I would consider it safe to say that overall SDGE performs at about average reliability among CA power utilities.

## Rates

::: {.callout-note}
## From PCF's 'Facts on SDG&E'
SDG&E charges electricity customers the highest rates in the state. [Source Data](https://www.eia.gov/electricity/sales_revenue_price/): U.S. Energy Information Administration, 2020 Data, Table T6, Residential Sector, California Utilities with over 100,000 customers.
:::

Taking a look at the linked data source, we can see that Table T6 is specifically the table that displays c/kWh for residential customers. We can also see that SDGE charged 25.51 c/kWh in T6 2020. We can take the USEIA raw data and manipulate it to align with this table so we can sort it and look at the rankings.

```{r}
cpkwh = function(df, category) {
  category_td_col = sprintf('thousand_dollars_%s', category)
  category_mwh_col = sprintf('megawatthours_%s', category)
  tens_dollars = df[,category_td_col] * 100
  cpkwh_col = sprintf('cpkwh_%s', category)
  df[,cpkwh_col] = tens_dollars / df[,category_mwh_col]
  return(df)
}

sales = read_xlsx('data/all_sales.xlsx') %>%
  cpkwh('residential') %>%
  cpkwh('commercial') %>%
  cpkwh('industrial') %>%
  cpkwh('transportation') %>%
  cpkwh('total')

sales2020_ca = sales %>%
  filter(
    data_year == 2020,
    state == 'CA'
  )

sales2020_ca = sales2020_ca %>%
  arrange(desc(cpkwh_residential))

sales2020_ca %>%
  select(
    data_year, utility_name, part, service_type, 
    customers_residential, cpkwh_residential
  ) %>%
  head(10) %>%
  gt()
```

Even when we account for the customer base, SDGE is still only the second highest rate in California. Let's see if this is at least true for 2024.

```{r}
sales2024_ca = sales %>%
  filter(
    data_year == 2024,
    state == 'CA'
  )

sales2024_ca = sales2024_ca %>%
  arrange(desc(cpkwh_residential))

sales2024_ca %>%
  select(
    data_year, utility_name, part, service_type, 
    customers_residential, cpkwh_residential
  ) %>%
  head(10) %>%
  gt()
```

Well it's definitely true for 2024, and it's by a non-negligible margin. Again let's observe trends through the years and see how SDGE measures up against the median.

```{r}
sales_filtered = sales %>%
  filter(
    str_count(utility_name, 'Adjustment') == 0,
    part == 'A',
    state == 'CA'
  )

ca_median_rates = sales_filtered %>%
  group_by(data_year) %>%
  summarize(
    cpkwh_residential = median(cpkwh_residential, na.rm = TRUE)
  )

ca_median_rates$rate = 'CA Median'
ca_median_rates$rank = NA

sdge_rates = sales_filtered %>%
  filter(str_count(utility_name, 'San Diego') > 0) %>%
  select(
    data_year, cpkwh_residential
  )

sdge_rates$rate = 'SDGE'

sdge_ranks = sales_filtered %>%
  group_by(data_year) %>%
  arrange(desc(cpkwh_residential)) %>%
  mutate(rank = order(order(cpkwh_residential, decreasing = TRUE))) %>%
  ungroup()
sdge_ranks = sdge_ranks %>% filter(str_count(utility_name, 'San Diego') > 0) %>%
  .[,c('cpkwh_residential', 'rank')]

sdge_rates = sdge_rates %>%
  left_join(sdge_ranks, by = 'cpkwh_residential')

rates_viz_df = rbind(ca_median_rates, sdge_rates)
rates_viz_df = rates_viz_df %>%
  mutate(rank = ifelse((!is.na(rank)) & (rank <= 3), sprintf('%s: Rank %s', data_year, rank), NA))

ggplot(rates_viz_df, aes(x = data_year, y = cpkwh_residential, color = rate, group = rate)) +
  geom_textline(aes(label = rate), hjust = 0) +
  geom_label_repel(aes(label = rank), ) +
  scale_color_manual(values = mycolors) +
  theme_minimal() +
  labs(
    x = '',
    y = 'Residential c/kWh',
    title = 'SDGE vs. CA Median',
    subtitle = 'USEIA 2010-2024 Data'
  ) +
  theme(
    legend.position = 'none'
  )
```

Again this tells us the more interesting story. SDGE has certainly always been on the expensive side compared to the average energy rate in California. I've also added labels to the years where SDGE ranks in the top 3 most expensive energy companies. We can see that since 2018 SDGE has been in the top 3 most expensive power companies in California every year except 2020. Let's observe the same data, but only for power companies that serve at least 1000 customers.

```{r}
sales_filtered = sales %>%
  filter(
    str_count(utility_name, 'Adjustment') == 0,
    part == 'A',
    state == 'CA',
    customers_residential >= 1000
  )

ca_median_rates = sales_filtered %>%
  group_by(data_year) %>%
  summarize(
    cpkwh_residential = median(cpkwh_residential, na.rm = TRUE)
  )

ca_median_rates$rate = 'CA Median'
ca_median_rates$rank = NA

sdge_rates = sales_filtered %>%
  filter(str_count(utility_name, 'San Diego') > 0) %>%
  select(
    data_year, cpkwh_residential
  )

sdge_rates$rate = 'SDGE'

sdge_ranks = sales_filtered %>%
  group_by(data_year) %>%
  arrange(desc(cpkwh_residential)) %>%
  mutate(rank = order(order(cpkwh_residential, decreasing = TRUE))) %>%
  ungroup()
sdge_ranks = sdge_ranks %>% filter(str_count(utility_name, 'San Diego') > 0) %>%
  .[,c('cpkwh_residential', 'rank')]

sdge_rates = sdge_rates %>%
  left_join(sdge_ranks, by = 'cpkwh_residential')

rates_viz_df = rbind(ca_median_rates, sdge_rates)
rates_viz_df = rates_viz_df %>%
  mutate(rank = ifelse((!is.na(rank)) & (rank <= 3), sprintf('%s: Rank %s', data_year, rank), NA))

ggplot(rates_viz_df, aes(x = data_year, y = cpkwh_residential, color = rate, group = rate)) +
  geom_textline(aes(label = rate), hjust = 0) +
  geom_label_repel(aes(label = rank), ) +
  scale_color_manual(values = mycolors) +
  theme_minimal() +
  labs(
    x = '',
    y = 'Residential c/kWh',
    title = 'SDGE vs. CA Median',
    subtitle = 'USEIA 2010-2024 Data'
  ) +
  theme(
    legend.position = 'none'
  )
```

When we remove miniscule premium power services, we see that SDGE has been in the top 3 most expensive power companies in California since 2015 and has been the most expensive since 2020.

I won't bother with a statistical test. The difference between the median and SDGE in the visualizations speaks for itself.

### Final Fact-Check Status

*Technically False*

The exact claim on PCF's website is unequivocally false. In 2020 SDGE was *not* the most expensive power company providing residential service. However, in the same way that PCF's claims about reliability was somewhat lacking in nuance, so is this one. While SDGE is technically not the most expensive power company in California, it is far more expensive than your average California power utility and consistently ranks in the top 3 most expensive in the state, holding the number 1 most expensive position among its peers for 4 years running.

## Renewable and GHG-Free Energy

```{r}
n = length(2016:2023) * 3
power_content_labels = data.frame(
  data_year = rep(2016:2023, 3),
  utility_name = c(rep('SDGE', n / 3), rep('SDCP', n / 3), rep('CA Average', n / 3)),
  biomass = c(0.01, 0.02, 0.02, 0.022, 0.021, 0.009, 0.029, 0.007, NA, NA, NA, NA, NA, 0.069, 0.012, 0.073, 0.02, 0.02, 0.02, 0.024, 0.025, 0.023, 0.021, 0.021),
  geothermal = c(0, 0, 0, 0, 0, 0, 0, 0, NA, NA, NA, NA, NA, 0.038, 0.026, 0.007, 0.04, 0.04, 0.05, 0.048, 0.049, 0.048, 0.047, 0.048),
  ren_hydroelectric = c(0, 0, 0, 0, 0, 0, 0, 0.001, NA, NA, NA, NA, NA, 0.005, 0.013, 0.005, 0.02, 0.03, 0.02, 0.02, 0.014, 0.01, 0.011, 0.018),
  solar = c(0.21, 0.21, 0.2, 0.165, 0.179, 0.285, 0.28, 0.226, NA, NA, NA, NA, NA, 0.288, 0.255, 0.273, 0.08, 0.1, 0.11, 0.123, 0.132, 0.142, 0.17, 0.17),
  wind = c(0.21, 0.21, 0.21, 0.126, 0.11, 0.152, 0.139, 0.18, NA, NA, NA, NA, NA, 0.148, 0.236, 0.153, 0.09, 0.1, 0.11, 0.102, 0.111, 0.114, 0.108, 0.112),
  coal = c(0, 0, 0, 0, 0, 0, 0, 0, NA, NA, NA, NA, NA, 0, 0, 0, 0.04, 0.04, 0.03, 0.03, 0.027, 0.03, 0.021, 0.018),
  hydroelectric = c(0, 0, 0, 0, 0.017, 0.018, 0, 0.002, NA, NA, NA, NA, NA, 0.118, 0.128, 0.043, 0.1, 0.15, 0.11, 0.146, 0.122, 0.092, 0.092, 0.117),
  nat_gas = c(0.42, 0.39, 0.29, 0.244, 0.262, 0.296, 0.544, 0.584, NA, NA, NA, NA, NA, 0, 0, 0, 0.37, 0.34, 0.35, 0.342, 0.371, 0.379, 0.364, 0.366),
  nuclear = c(0, 0, 0, 0, 0.002, 0.002, 0, 0, NA, NA, NA, NA, NA, 0, 0, 0, 0.09, 0.09, 0.09, 0.09, 0.093, 0.093, 0.092, 0.093),
  other = c(0, 0, 0.01, 0, 0, 0, 0, 0, NA, NA, NA, NA, NA, 0, 0, 0, 0, 0.01, 0.01, 0.002, 0.002, 0.002, 0.001, 0.001),
  unspecified = c(0.15, 0.17, 0.27, 0.442, 0.409, 0.239, 0.008, 0, NA, NA, NA, NA, NA, 0.333, 0.331, 0.446, 0.15, 0.09, 0.11, 0.073, 0.054, 0.068, 0.071, 0.037)
)

# integrity check
# apply(power_content_labels[,3:ncol(power_content_labels)], 1, sum) # should return an array of 1s or NA
# sum(power_content_labels[,3:ncol(power_content_labels)], na.rm = TRUE) # should be 19 (8 sdge, 8 ca av, 3 sdcp)
```

::: {.callout-note}
## From PCF's 'Facts on SDG&E'
SDG&E provides below-average renewable energy content compared to other California electricity providers (renewable energy as defined by the California Public Utilities Code). [Source Data](https://www.energy.ca.gov/programs-and-topics/programs/power-source-disclosure-program/power-content-label/annual-power): California Power Content Labels as reported by the California Energy Commission.
:::

::: {.callout-note}
## From PCF's 'Facts on SDG&E'
SDG&E provides below-average greenhouse-gas-free energy content compared to other California electricity providers. [Greenhouse-gas-free energy = (renewable energy) â€“ (biomass & biogas) + (large hydroelectric) + (nuclear)]. [Source Data](https://www.energy.ca.gov/programs-and-topics/programs/power-source-disclosure-program/power-content-label/annual-power): California Power Content Labels as reported by the California Energy Commission.
:::

PCF's website links to specifically the 2019 power content labels, although no year is specified in the claims themselves. I'm going to fact check them against the 2019 power content labels.

After painstakingly and manually hand-entering power label data into an R dataframe, we can observe GHG free and renewable energy proportions in the plot below.

```{r}
calculate_renewables = function(df) {
  renewables = df[,3:7]
  renewables_sum = apply(renewables, 1, sum)
  df$renewable = renewables_sum
  return(df)
}

calculate_ghg_free = function(df) {
  ghg_free = df[,c(4:7, 9, 11)]
  ghg_free_sum = apply(ghg_free, 1, sum)
  df$ghg_free = ghg_free_sum
  return(df)
}

power_content_labels = power_content_labels %>%
  calculate_renewables() %>%
  calculate_ghg_free()

sdge_av = power_content_labels %>%
  filter(utility_name != 'SDCP') %>%
  melt(
    id.vars = c('data_year', 'utility_name'),
    measure.vars = c('renewable', 'ghg_free'),
    variable.name = 'metric'
  ) %>%
  mutate(
    metric = ifelse(
      metric == 'renewable',
      'Renewable',
      'GHG Free'
    )
  )

ggplot(sdge_av, aes(x = data_year, y = value, color = utility_name, group = utility_name)) +
  geom_textline(aes(label = utility_name), hjust = 0.25) +
  labs(
    title = 'Proportion of Total Energy Generation by Year',
    subtitle = 'SDGE vs. CA Average 2016-2023',
    x = '',
    y = '',
    color = ''
  ) +
  facet_grid(metric ~ .) +
  theme_minimal() +
  theme(
    legend.position = 'none'
  ) +
  scale_color_manual(values = mycolors) +
  scale_y_continuous(
    breaks = c(0.3, 0.4, 0.5, 0.6),
    labels = c('30%', '40%', '50%', '60%')
  ) +
  scale_x_continuous(
    breaks = 2016:2023
  )
```

An interesting pattern is developing regarding PCF's claims. They do certainly seem to enjoy cherry-picking their data. One very interesting thing to me in this plot is that over 50% of California's electrical energy comes from sources that do not generate greenhouse gases, even if they are not renewable, and that is laudable in itself.

### Final Fact-Check Status

#### Renewable Energy

*Technically True*

#### GHG Free Energy

*Unequivocally True*

While PCF's claim about renewable energy is unequivocally true for the 2019 year, it is similar to their claim about reliability, as it relies on one of only 2 years that SDGE had below-average renewables. Outside of 2019 and 2020 SDGE actually performs quite well on renewables when compared to the CA average.

However, PCF's claim about SDGE's GHG free energy use is unequivocally true. SDGE uses below average GHG free energy content than the CA average. Every year, without question, and non-negligibly. I actually think this is the more damning claim, as who cares about renewability if you continue to contribute to climate change anyway. Isn't that what this is all about?

Something interesting to note, here, however, is that, on average, CA power content consists of more than 50% GHG free sources. That is laudable in and of itself.

